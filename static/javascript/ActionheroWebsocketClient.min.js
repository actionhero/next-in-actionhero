!function(t,e,n,r){e[t]=n.call(e);for(var i=0;i<r.length;i++)r[i](e[t]);"undefined"!=typeof module&&module.exports?module.exports=e[t]:"function"==typeof define&&define.amd&&define(function(){return e[t]})}("Primus",this||{},function(){return function t(e,n,r){function i(s,c){if(!n[s]){if(!e[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[s]={exports:{}};e[s][0].call(h.exports,function(t){var n=e[s][1][t];return i(n||t)},h,h.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){"use strict";e.exports=function(t,e){function n(t,n){if(e[t]){if("string"==typeof e[t]&&(e[t]=e[t].split(r)),"function"==typeof e[t])return e[t].call(n);for(var i,o,s=0;s<e[t].length;s++)"function"===(i=typeof(o=e[t][s]))?o.call(n):"string"===i&&"function"==typeof n[o]&&n[o]()}}var r=/[, ]+/;return e=e||{},"string"==typeof(t=t||[])&&(t=t.split(r)),function(){var e,r=0;if(null===this[t[0]])return!1;for(n("before",this);r<t.length;r++)this[e=t[r]]&&("function"==typeof this[e].destroy&&this[e].destroy(),this[e]=null);return this.emit&&this.emit("destroy"),n("after",this),!0}}},{}],2:[function(t,e,n){"use strict";e.exports=function(){for(var t,e=this,n=0,r=arguments.length,i=new Array(r);n<r;n++)i[n]=arguments[n];return"function"!=typeof i[i.length-1]?function(){for(var t=0,n=arguments.length,r=new Array(n);t<n;t++)r[t]=arguments[t];return e.emit.apply(e,i.concat(r))}:(t=i.pop(),function(){for(var n=0,r=arguments.length,o=new Array(r+1);n<r;n++)o[n+1]=arguments[n];return o[0]=function(t,n){if(t)return e.emit("error",t);o=void 0===n?o.slice(1):null===n?[]:n,e.emit.apply(e,i.concat(o))},t.apply(e,o),!0})}},{}],3:[function(t,e,n){"use strict";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(){this._events=new r,this._eventsCount=0}var s=Object.prototype.hasOwnProperty,c="~";Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(c=!1)),o.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)s.call(t,e)&&n.push(c?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},o.prototype.listeners=function(t,e){var n=c?c+t:t,r=this._events[n];if(e)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,s=new Array(o);i<o;i++)s[i]=r[i].fn;return s},o.prototype.emit=function(t,e,n,r,i,o){var s=c?c+t:t;if(!this._events[s])return!1;var a,u,h=this._events[s],f=arguments.length;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),f){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,n),!0;case 4:return h.fn.call(h.context,e,n,r),!0;case 5:return h.fn.call(h.context,e,n,r,i),!0;case 6:return h.fn.call(h.context,e,n,r,i,o),!0}for(u=1,a=new Array(f-1);u<f;u++)a[u-1]=arguments[u];h.fn.apply(h.context,a)}else{var p,l=h.length;for(u=0;u<l;u++)switch(h[u].once&&this.removeListener(t,h[u].fn,void 0,!0),f){case 1:h[u].fn.call(h[u].context);break;case 2:h[u].fn.call(h[u].context,e);break;case 3:h[u].fn.call(h[u].context,e,n);break;case 4:h[u].fn.call(h[u].context,e,n,r);break;default:if(!a)for(p=1,a=new Array(f-1);p<f;p++)a[p-1]=arguments[p];h[u].fn.apply(h[u].context,a)}}return!0},o.prototype.on=function(t,e,n){var r=new i(e,n||this),o=c?c+t:t;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):(this._events[o]=r,this._eventsCount++),this},o.prototype.once=function(t,e,n){var r=new i(e,n||this,!0),o=c?c+t:t;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):(this._events[o]=r,this._eventsCount++),this},o.prototype.removeListener=function(t,e,n,i){var o=c?c+t:t;if(!this._events[o])return this;if(!e)return 0==--this._eventsCount?this._events=new r:delete this._events[o],this;var s=this._events[o];if(s.fn)s.fn!==e||i&&!s.once||n&&s.context!==n||(0==--this._eventsCount?this._events=new r:delete this._events[o]);else{for(var a=0,u=[],h=s.length;a<h;a++)(s[a].fn!==e||i&&!s[a].once||n&&s[a].context!==n)&&u.push(s[a]);u.length?this._events[o]=1===u.length?u[0]:u:0==--this._eventsCount?this._events=new r:delete this._events[o]}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=c?c+t:t,this._events[e]&&(0==--this._eventsCount?this._events=new r:delete this._events[e])):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.prefixed=c,o.EventEmitter=o,void 0!==e&&(e.exports=o)},{}],4:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],5:[function(t,e,n){"use strict";var r=new RegExp("^((?:\\d+)?\\.?\\d+) *("+["milliseconds?","msecs?","ms","seconds?","secs?","s","minutes?","mins?","m","hours?","hrs?","h","days?","d","weeks?","wks?","w","years?","yrs?","y"].join("|")+")?$","i");e.exports=function(t){var e,n,i=typeof t;if("number"===i)return t;if("string"!==i||"0"===t||!t)return 0;if(+t)return+t;if(t.length>1e4||!(n=r.exec(t)))return 0;switch(e=parseFloat(n[1]),n[2].toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 31536e6*e;case"weeks":case"week":case"wks":case"wk":case"w":return 6048e5*e;case"days":case"day":case"d":return 864e5*e;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*e;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*e;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*e;default:return e}}},{}],6:[function(t,e,n){"use strict";e.exports=function(t){function e(){return r?n:(r=1,n=t.apply(this,arguments),t=null,n)}var n,r=0;return e.displayName=t.displayName||t.name||e.displayName||e.name,e}},{}],7:[function(t,e,n){"use strict";function r(t){return decodeURIComponent(t.replace(/\+/g," "))}var i=Object.prototype.hasOwnProperty;n.stringify=function(t,e){var n=[];"string"!=typeof(e=e||"")&&(e="?");for(var r in t)i.call(t,r)&&n.push(encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return n.length?e+n.join("&"):""},n.parse=function(t){for(var e,n=/([^=?&]+)=?([^&]*)/g,i={};e=n.exec(t);i[r(e[1])]=r(e[2]));return i}},{}],8:[function(t,e,n){"use strict";function r(t,e,n){return s(t in n?n[t]:t in e?e[t]:i[t])}function i(t){if(!(this instanceof i))return new i(t);t=t||{},this.attempt=null,this._fn=null,this["reconnect timeout"]=r("reconnect timeout",this,t),this.retries=r("retries",this,t),this.factor=r("factor",this,t),this.max=r("max",this,t),this.min=r("min",this,t),this.timers=new a(this)}var o=t("eventemitter3"),s=t("millisecond"),c=t("demolish"),a=t("tick-tock"),u=t("one-time");(i.prototype=new o).constructor=i,i["reconnect timeout"]="30 seconds",i.max=1/0,i.min="500 ms",i.retries=10,i.factor=2,i.prototype.reconnect=function(){var t=this;return t.backoff(function(e,n){if(n.duration=+new Date-n.start,e)return t.emit("reconnect failed",e,n);t.emit("reconnected",n)},t.attempt)},i.prototype.backoff=function(t,e){var n=this;return(e=e||n.attempt||{}).backoff?n:(e["reconnect timeout"]=r("reconnect timeout",n,e),e.retries=r("retries",n,e),e.factor=r("factor",n,e),e.max=r("max",n,e),e.min=r("min",n,e),e.start=+e.start||+new Date,e.duration=+e.duration||0,e.attempt=+e.attempt||0,e.attempt===e.retries?(t.call(n,new Error("Unable to recover"),e),n):(e.backoff=!0,e.attempt++,n.attempt=e,e.scheduled=1!==e.attempt?Math.min(Math.round((Math.random()+1)*e.min*Math.pow(e.factor,e.attempt-1)),e.max):e.min,n.timers.setTimeout("reconnect",function(){e.duration=+new Date-e.start,e.backoff=!1,n.timers.clear("reconnect, timeout");var r=n._fn=u(function(r){if(n.reset(),r)return n.backoff(t,e);t.call(n,void 0,e)});n.emit("reconnect",e,r),n.timers.setTimeout("timeout",function(){var t=new Error("Failed to reconnect in a timely manner");e.duration=+new Date-e.start,n.emit("reconnect timeout",t,e),r(t)},e["reconnect timeout"])},e.scheduled),n.emit("reconnect scheduled",e),n))},i.prototype.reconnecting=function(){return!!this.attempt},i.prototype.reconnected=function(t){return this._fn&&this._fn(t),this},i.prototype.reset=function(){return this._fn=this.attempt=null,this.timers.clear("reconnect, timeout"),this},i.prototype.destroy=c("timers attempt _fn"),e.exports=i},{demolish:1,eventemitter3:9,millisecond:5,"one-time":6,"tick-tock":11}],9:[function(t,e,n){"use strict";function r(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(){}var o="function"!=typeof Object.create&&"~";i.prototype._events=void 0,i.prototype.listeners=function(t,e){var n=o?o+t:t,r=this._events&&this._events[n];if(e)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,c=new Array(s);i<s;i++)c[i]=r[i].fn;return c},i.prototype.emit=function(t,e,n,r,i,s){var c=o?o+t:t;if(!this._events||!this._events[c])return!1;var a,u,h=this._events[c],f=arguments.length;if("function"==typeof h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),f){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,n),!0;case 4:return h.fn.call(h.context,e,n,r),!0;case 5:return h.fn.call(h.context,e,n,r,i),!0;case 6:return h.fn.call(h.context,e,n,r,i,s),!0}for(u=1,a=new Array(f-1);u<f;u++)a[u-1]=arguments[u];h.fn.apply(h.context,a)}else{var p,l=h.length;for(u=0;u<l;u++)switch(h[u].once&&this.removeListener(t,h[u].fn,void 0,!0),f){case 1:h[u].fn.call(h[u].context);break;case 2:h[u].fn.call(h[u].context,e);break;case 3:h[u].fn.call(h[u].context,e,n);break;default:if(!a)for(p=1,a=new Array(f-1);p<f;p++)a[p-1]=arguments[p];h[u].fn.apply(h[u].context,a)}}return!0},i.prototype.on=function(t,e,n){var i=new r(e,n||this),s=o?o+t:t;return this._events||(this._events=o?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],i]:this._events[s].push(i):this._events[s]=i,this},i.prototype.once=function(t,e,n){var i=new r(e,n||this,!0),s=o?o+t:t;return this._events||(this._events=o?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],i]:this._events[s].push(i):this._events[s]=i,this},i.prototype.removeListener=function(t,e,n,r){var i=o?o+t:t;if(!this._events||!this._events[i])return this;var s=this._events[i],c=[];if(e)if(s.fn)(s.fn!==e||r&&!s.once||n&&s.context!==n)&&c.push(s);else for(var a=0,u=s.length;a<u;a++)(s[a].fn!==e||r&&!s[a].once||n&&s[a].context!==n)&&c.push(s[a]);return c.length?this._events[i]=1===c.length?c[0]:c:delete this._events[i],this},i.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[o?o+t:t]:this._events=o?{}:Object.create(null),this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=o,void 0!==e&&(e.exports=i)},{}],10:[function(t,e,n){"use strict";e.exports=function(t,e){if(e=e.split(":")[0],!(t=+t))return!1;switch(e){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 21!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t}},{}],11:[function(t,e,n){"use strict";function r(t,e,n,r){this.start=+new Date,this.duration=n,this.clear=e,this.timer=t,this.fns=[r]}function i(t){clearTimeout(t)}function o(t){clearInterval(t)}function s(t){clearImmediate(t)}function c(t){if(!(this instanceof c))return new c(t);this.timers={},this.context=t||this}var a=Object.prototype.hasOwnProperty,u=t("millisecond");r.prototype.remaining=function(){return this.duration-this.taken()},r.prototype.taken=function(){return+new Date-this.start},c.prototype.tock=function(t,e){var n=this;return function(){if(t in n.timers){var r=n.timers[t].fns.slice(),i=r.length,o=0;for(e?n.clear(t):n.start=+new Date;o<i;o++)r[o].call(n.context)}}},c.prototype.setTimeout=function(t,e,n){var o;return this.timers[t]?(this.timers[t].fns.push(e),this):(o=u(n),this.timers[t]=new r(setTimeout(this.tock(t,!0),u(n)),i,o,e),this)},c.prototype.setInterval=function(t,e,n){var i;return this.timers[t]?(this.timers[t].fns.push(e),this):(i=u(n),this.timers[t]=new r(setInterval(this.tock(t),u(n)),o,i,e),this)},c.prototype.setImmediate=function(t,e){return"function"!=typeof setImmediate?this.setTimeout(t,e,0):this.timers[t]?(this.timers[t].fns.push(e),this):(this.timers[t]=new r(setImmediate(this.tock(t,!0)),s,0,e),this)},c.prototype.active=function(t){return t in this.timers},c.prototype.clear=function(){var t,e,n,r=arguments.length?arguments:[];if(1===r.length&&"string"==typeof r[0]&&(r=r[0].split(/[, ]+/)),!r.length)for(t in this.timers)a.call(this.timers,t)&&r.push(t);for(e=0,n=r.length;e<n;e++)(t=this.timers[r[e]])&&(t.clear(t.timer),t.fns=t.timer=t.clear=null,delete this.timers[r[e]]);return this},c.prototype.adjust=function(t,e){var n,r=u(e),i=this.timers[t];return i?(n=i.clear===o,i.clear(i.timer),i.start=+new Date,i.duration=r,i.timer=(n?setInterval:setTimeout)(this.tock(t,!n),r),this):this},c.prototype.end=c.prototype.destroy=function(){return!!this.context&&(this.clear(),this.context=this.timers=null,!0)},c.Timer=r,e.exports=c},{millisecond:5}],12:[function(t,e,n){(function(n){"use strict";function r(t){var e,r={},i=typeof(t=t||n.location||{});if("blob:"===t.protocol)r=new o(unescape(t.pathname),{});else if("string"===i){r=new o(t,{});for(e in f)delete r[e]}else if("object"===i){for(e in t)e in f||(r[e]=t[e]);void 0===r.slashes&&(r.slashes=u.test(t.href))}return r}function i(t){var e=a.exec(t);return{protocol:e[1]?e[1].toLowerCase():"",slashes:!!e[2],rest:e[3]}}function o(t,e,n){if(!(this instanceof o))return new o(t,e,n);var a,u,f,p,l,m,d=h.slice(),y=typeof e,v=0;for("object"!==y&&"string"!==y&&(n=e,e=null),n&&"function"!=typeof n&&(n=c.parse),e=r(e),a=!(u=i(t||"")).protocol&&!u.slashes,this.slashes=u.slashes||a&&e.slashes,this.protocol=u.protocol||e.protocol||"",t=u.rest,u.slashes||(d[2]=[/(.*)/,"pathname"]);v<d.length;v++)f=(p=d[v])[0],m=p[1],f!=f?this[m]=t:"string"==typeof f?~(l=t.indexOf(f))&&("number"==typeof p[2]?(this[m]=t.slice(0,l),t=t.slice(l+p[2])):(this[m]=t.slice(l),t=t.slice(0,l))):(l=f.exec(t))&&(this[m]=l[1],t=t.slice(0,l.index)),this[m]=this[m]||(a&&p[3]?e[m]||"":""),p[4]&&(this[m]=this[m].toLowerCase());n&&(this.query=n(this.query)),a&&e.slashes&&"/"!==this.pathname.charAt(0)&&(""!==this.pathname||""!==e.pathname)&&(this.pathname=function(t,e){for(var n=(e||"/").split("/").slice(0,-1).concat(t.split("/")),r=n.length,i=n[r-1],o=!1,s=0;r--;)"."===n[r]?n.splice(r,1):".."===n[r]?(n.splice(r,1),s++):s&&(0===r&&(o=!0),n.splice(r,1),s--);return o&&n.unshift(""),"."!==i&&".."!==i||n.push(""),n.join("/")}(this.pathname,e.pathname)),s(this.port,this.protocol)||(this.host=this.hostname,this.port=""),this.username=this.password="",this.auth&&(p=this.auth.split(":"),this.username=p[0]||"",this.password=p[1]||""),this.origin=this.protocol&&this.host&&"file:"!==this.protocol?this.protocol+"//"+this.host:"null",this.href=this.toString()}var s=t("requires-port"),c=t("querystringify"),a=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,u=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,h=[["#","hash"],["?","query"],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],f={hash:1,query:1};o.prototype={set:function(t,e,n){switch(t){case"query":"string"==typeof e&&e.length&&(e=(n||c.parse)(e)),this[t]=e;break;case"port":this[t]=e,s(e,this.protocol)?e&&(this.host=this.hostname+":"+e):(this.host=this.hostname,this[t]="");break;case"hostname":this[t]=e,this.port&&(e+=":"+this.port),this.host=e;break;case"host":this[t]=e,/:\d+$/.test(e)?(e=e.split(":"),this.port=e.pop(),this.hostname=e.join(":")):(this.hostname=e,this.port="");break;case"protocol":this.protocol=e.toLowerCase(),this.slashes=!n;break;case"pathname":this.pathname=e.length&&"/"!==e.charAt(0)?"/"+e:e;break;default:this[t]=e}for(var r=0;r<h.length;r++){var i=h[r];i[4]&&(this[i[1]]=this[i[1]].toLowerCase())}return this.origin=this.protocol&&this.host&&"file:"!==this.protocol?this.protocol+"//"+this.host:"null",this.href=this.toString(),this},toString:function(t){t&&"function"==typeof t||(t=c.stringify);var e,n=this.protocol;n&&":"!==n.charAt(n.length-1)&&(n+=":");var r=n+(this.slashes?"//":"");return this.username&&(r+=this.username,this.password&&(r+=":"+this.password),r+="@"),r+=this.host+this.pathname,(e="object"==typeof this.query?t(this.query):this.query)&&(r+="?"!==e.charAt(0)?"?"+e:e),this.hash&&(r+=this.hash),r}},o.extractProtocol=i,o.location=r,o.qs=c,e.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{querystringify:7,"requires-port":10}],13:[function(t,e,n){"use strict";function r(t){var e="";do{e=s[t%c]+e,t=Math.floor(t/c)}while(t>0);return e}function i(){var t=r(+new Date);return t!==o?(u=0,o=t):t+"."+r(u++)}for(var o,s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),c=64,a={},u=0,h=0;h<c;h++)a[s[h]]=h;i.encode=r,i.decode=function(t){var e=0;for(h=0;h<t.length;h++)e=e*c+a[t.charAt(h)];return e},e.exports=i},{}],14:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof i)){var n=new Error("Primus#"+e+"'s context should called with a Primus instance");if("function"!=typeof t.listeners||!t.listeners("error").length)throw n;t.emit("error",n)}}function i(t,e){if(!(this instanceof i))return new i(t,e);if(i.Stream.call(this),"function"!=typeof this.client)return this.critical(new Error("The client library has not been compiled correctly, see https://github.com/primus/primus#client-library for more details"));if("object"==typeof t?t=(e=t).url||e.uri||o:e=e||{},"ping"in e||"pong"in e)return this.critical(new Error("The `ping` and `pong` options have been removed"));var n=this;e.queueSize="queueSize"in e?e.queueSize:1/0,e.timeout="timeout"in e?e.timeout:1e4,e.reconnect="reconnect"in e?e.reconnect:{},e.pingTimeout="pingTimeout"in e?e.pingTimeout:45e3,e.strategy="strategy"in e?e.strategy:[],e.transport="transport"in e?e.transport:{},n.buffer=[],n.writable=!0,n.readable=!0,n.url=n.parse(t||o),n.readyState=i.CLOSED,n.options=e,n.timers=new c(this),n.socket=null,n.disconnect=!1,n.transport=e.transport,n.transformers={outgoing:[],incoming:[]},n.recovery=new a(e.reconnect),"string"==typeof e.strategy&&(e.strategy=e.strategy.split(/\s?,\s?/g)),!1===e.strategy?e.strategy=[]:e.strategy.length||(e.strategy.push("disconnect","online"),this.authorization||e.strategy.push("timeout")),e.strategy=e.strategy.join(",").toLowerCase(),"websockets"in e&&(n.AVOID_WEBSOCKETS=!e.websockets),"network"in e&&(n.NETWORK_EVENTS=e.network),e.manual||n.timers.setTimeout("open",function(){n.timers.clear("open"),n.open()},0),n.initialise(e)}var o,s=t("eventemitter3"),c=t("tick-tock"),a=t("recovery"),u=t("querystringify"),h=t("inherits"),f=t("demolish"),p=t("yeast"),l=/\u2028/g,m=/\u2029/g;try{o=location.origin?location.origin:location.protocol+"//"+location.host}catch(t){o="http://127.0.0.1"}i.requires=i.require=function(e){if("function"==typeof t)return t(e)};try{i.Stream=i.requires("stream")}catch(t){}i.Stream||(i.Stream=s),h(i,i.Stream),i.OPENING=1,i.CLOSED=2,i.OPEN=3,i.prototype.AVOID_WEBSOCKETS=!1,i.prototype.NETWORK_EVENTS=!1,i.prototype.online=!0;try{(i.prototype.NETWORK_EVENTS="onLine"in navigator&&(window.addEventListener||document.body.attachEvent))&&(navigator.onLine||(i.prototype.online=!1))}catch(t){}if(i.prototype.ark={},i.prototype.emits=t("emits"),i.prototype.plugin=function(t){if(r(this,"plugin"),t)return this.ark[t];var e={};for(t in this.ark)e[t]=this.ark[t];return e},i.prototype.reserved=function(t){return/^(incoming|outgoing)::/.test(t)||t in this.reserved.events},i.prototype.reserved.events={"reconnect scheduled":1,"reconnect timeout":1,readyStateChange:1,"reconnect failed":1,reconnected:1,reconnect:1,offline:1,timeout:1,destroy:1,online:1,error:1,close:1,open:1,data:1,end:1},i.prototype.initialise=function(t){var e=this;e.recovery.on("reconnected",e.emits("reconnected")).on("reconnect failed",e.emits("reconnect failed",function(t){e.emit("end"),t()})).on("reconnect timeout",e.emits("reconnect timeout")).on("reconnect scheduled",e.emits("reconnect scheduled")).on("reconnect",e.emits("reconnect",function(t){e.emit("outgoing::reconnect"),t()})),e.on("outgoing::open",function(){var t=e.readyState;e.readyState=i.OPENING,t!==e.readyState&&e.emit("readyStateChange","opening")}),e.on("incoming::open",function(){var t=e.readyState;if(e.recovery.reconnecting()&&e.recovery.reconnected(),e.writable=!0,e.readable=!0,e.online||(e.online=!0,e.emit("online")),e.readyState=i.OPEN,t!==e.readyState&&e.emit("readyStateChange","open"),e.heartbeat(),e.buffer.length){var n=e.buffer.slice(),r=n.length,o=0;for(e.buffer.length=0;o<r;o++)e._write(n[o])}e.emit("open")}),e.on("incoming::ping",function(t){e.online=!0,e.heartbeat(),e.emit("outgoing::pong",t),e._write("primus::pong::"+t)}),e.on("incoming::error",function(t){var n=e.timers.active("connect"),r=t;if("string"==typeof t)r=new Error(t);else if(!(t instanceof Error)&&"object"==typeof t){r=new Error(t.message||t.reason);for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}if(e.recovery.reconnecting())return e.recovery.reconnected(r);e.listeners("error").length&&e.emit("error",r),n&&(~e.options.strategy.indexOf("timeout")?e.recovery.reconnect():e.end())}),e.on("incoming::data",function(t){e.decoder(t,function(n,r){if(n)return e.listeners("error").length&&e.emit("error",n);e.protocol(r)||e.transforms(e,e,"incoming",r,t)})}),e.on("incoming::end",function(){var t=e.readyState;return e.disconnect?(e.disconnect=!1,e.end()):(e.readyState=i.CLOSED,t!==e.readyState&&e.emit("readyStateChange","end"),e.timers.active("connect")&&e.end(),t!==i.OPEN?!!e.recovery.reconnecting()&&e.recovery.reconnect():(this.writable=!1,this.readable=!1,this.timers.clear(),e.emit("close"),~e.options.strategy.indexOf("disconnect")?e.recovery.reconnect():(e.emit("outgoing::end"),void e.emit("end"))))}),e.client();for(var n in e.ark)e.ark[n].call(e,e,t);return e.NETWORK_EVENTS?(e.offlineHandler=function(){e.online&&(e.online=!1,e.emit("offline"),e.end(),e.recovery.reset())},e.onlineHandler=function(){e.online||(e.online=!0,e.emit("online"),~e.options.strategy.indexOf("online")&&e.recovery.reconnect())},window.addEventListener?(window.addEventListener("offline",e.offlineHandler,!1),window.addEventListener("online",e.onlineHandler,!1)):document.body.attachEvent&&(document.body.attachEvent("onoffline",e.offlineHandler),document.body.attachEvent("ononline",e.onlineHandler)),e):e},i.prototype.protocol=function(t){if("string"!=typeof t||0!==t.indexOf("primus::"))return!1;var e=t.indexOf(":",8),n=t.slice(e+2);switch(t.slice(8,e)){case"ping":this.emit("incoming::ping",+n);break;case"server":"close"===n&&(this.disconnect=!0);break;case"id":this.emit("incoming::id",n);break;default:return!1}return!0},i.prototype.transforms=function(t,e,n,r,i){var o={data:r},s=t.transformers[n];return function t(n,r){var i=s[n++];if(!i)return r();if(1===i.length){if(!1===i.call(e,o))return;return t(n,r)}i.call(e,o,function(i,o){if(i)return e.emit("error",i);!1!==o&&t(n,r)})}(0,function(){if("incoming"===n)return e.emit("data",o.data,i);e._write(o.data)}),this},i.prototype.id=function(t){return this.socket&&this.socket.id?t(this.socket.id):(this._write("primus::id::"),this.once("incoming::id",t))},i.prototype.open=function(){return r(this,"open"),!this.recovery.reconnecting()&&this.options.timeout&&this.timeout(),this.emit("outgoing::open"),this},i.prototype.write=function(t){return r(this,"write"),this.transforms(this,this,"outgoing",t),!0},i.prototype._write=function(t){var e=this;return i.OPEN!==e.readyState?(this.buffer.length===this.options.queueSize&&this.buffer.splice(0,1),this.buffer.push(t),!1):(e.encoder(t,function(t,n){if(t)return e.listeners("error").length&&e.emit("error",t);"string"==typeof n&&(~n.indexOf("\u2028")&&(n=n.replace(l,"\\u2028")),~n.indexOf("\u2029")&&(n=n.replace(m,"\\u2029"))),e.emit("outgoing::data",n)}),!0)},i.prototype.heartbeat=function(){return this.options.pingTimeout?(this.timers.clear("heartbeat"),this.timers.setTimeout("heartbeat",function(){this.online&&(this.online=!1,this.emit("offline"),this.emit("incoming::end"))},this.options.pingTimeout),this):this},i.prototype.timeout=function(){function t(){e.removeListener("error",t).removeListener("open",t).removeListener("end",t).timers.clear("connect")}var e=this;return e.timers.setTimeout("connect",function(){t(),e.readyState===i.OPEN||e.recovery.reconnecting()||(e.emit("timeout"),~e.options.strategy.indexOf("timeout")?e.recovery.reconnect():e.end())},e.options.timeout),e.on("error",t).on("open",t).on("end",t)},i.prototype.end=function(t){if(r(this,"end"),this.readyState===i.CLOSED&&!this.timers.active("connect")&&!this.timers.active("open"))return this.recovery.reconnecting()&&(this.recovery.reset(),this.emit("end")),this;void 0!==t&&this.write(t),this.writable=!1,this.readable=!1;var e=this.readyState;return this.readyState=i.CLOSED,e!==this.readyState&&this.emit("readyStateChange","end"),this.timers.clear(),this.emit("outgoing::end"),this.emit("close"),this.emit("end"),this},i.prototype.destroy=f("url timers options recovery socket transport transformers",{before:"end",after:["removeAllListeners",function(){this.NETWORK_EVENTS&&(window.addEventListener?(window.removeEventListener("offline",this.offlineHandler),window.removeEventListener("online",this.onlineHandler)):document.body.attachEvent&&(document.body.detachEvent("onoffline",this.offlineHandler),document.body.detachEvent("ononline",this.onlineHandler)))}]}),i.prototype.clone=function(t){return this.merge({},t)},i.prototype.merge=function(t){for(var e,n,r=1;r<arguments.length;r++){n=arguments[r];for(e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},i.prototype.parse=t("url-parse"),i.prototype.querystring=u.parse,i.prototype.querystringify=u.stringify,i.prototype.uri=function(t){var e=this.url,n=[],r=!1;t.query&&(r=!0),(t=t||{}).protocol="protocol"in t?t.protocol:"http:",t.query=!(!e.query||!r)&&e.query.slice(1),t.secure="secure"in t?t.secure:"https:"===e.protocol||"wss:"===e.protocol,t.auth="auth"in t?t.auth:e.auth,t.pathname="pathname"in t?t.pathname:this.pathname,t.port="port"in t?+t.port:+e.port||(t.secure?443:80);var i=this.querystring(t.query||"");return i._primuscb=p(),t.query=this.querystringify(i),this.emit("outgoing::url",t),n.push(t.secure?t.protocol.replace(":","s:"):t.protocol,""),n.push(t.auth?t.auth+"@"+e.host:e.host),t.pathname&&n.push(t.pathname.slice(1)),r?n[n.length-1]+="?"+t.query:delete t.query,t.object?t:n.join("/")},i.prototype.transform=function(t,e){return r(this,"transform"),t in this.transformers?(this.transformers[t].push(e),this):this.critical(new Error("Invalid transformer type"))},i.prototype.critical=function(t){if(this.emit("error",t))return this;throw t},i.connect=function(t,e){return new i(t,e)},i.EventEmitter=s,i.prototype.client=function(){var t,e=this,n=function(){if("undefined"!=typeof WebSocket)return WebSocket;if("undefined"!=typeof MozWebSocket)return MozWebSocket;try{return i.requires("ws")}catch(t){}}();if(!n)return e.critical(new Error("Missing required `ws` module. Please run `npm install --save ws`"));e.on("outgoing::open",function(){e.emit("outgoing::end");try{var r={protocol:"ws+unix:"===e.url.protocol?"ws+unix:":"ws:",query:!0};3===n.length?("ws+unix:"===r.protocol&&(r.pathname=e.url.pathname+":"+e.pathname),e.socket=t=new n(e.uri(r),[],e.transport)):(e.socket=t=new n(e.uri(r)),t.binaryType="arraybuffer")}catch(t){return e.emit("error",t)}t.onopen=e.emits("incoming::open"),t.onerror=e.emits("incoming::error"),t.onclose=e.emits("incoming::end"),t.onmessage=e.emits("incoming::data",function(t,e){t(void 0,e.data)})}),e.on("outgoing::data",function(r){if(t&&t.readyState===n.OPEN)try{t.send(r)}catch(t){e.emit("incoming::error",t)}}),e.on("outgoing::reconnect",function(){e.emit("outgoing::open")}),e.on("outgoing::end",function(){t&&(t.onerror=t.onopen=t.onclose=t.onmessage=function(){},t.close(),t=null)})},i.prototype.authorization=!1,i.prototype.pathname="/primus",i.prototype.encoder=function(t,e){var n;try{t=JSON.stringify(t)}catch(t){n=t}e(n,t)},i.prototype.decoder=function(t,e){var n;if("string"!=typeof t)return e(n,t);try{t=JSON.parse(t)}catch(t){n=t}e(n,t)},i.prototype.version="7.1.0","undefined"!=typeof document&&"undefined"!=typeof navigator){document.addEventListener&&document.addEventListener("keydown",function(t){27===t.keyCode&&t.preventDefault&&t.preventDefault()},!1);var d=(navigator.userAgent||"").toLowerCase(),y=d.match(/.+(?:rv|it|ra|ie)[/: ](\d+)\.(\d+)(?:\.(\d+))?/)||[],v=+[y[1],y[2]].join(".");!~d.indexOf("chrome")&&~d.indexOf("safari")&&v<534.54&&(i.prototype.AVOID_WEBSOCKETS=!0)}e.exports=i},{demolish:1,emits:2,eventemitter3:3,inherits:4,querystringify:7,recovery:8,"tick-tock":11,"url-parse":12,yeast:13}]},{},[14])(14)},[]),function(t){var e=function(t,e){this.callbacks={},this.id=null,this.events={},this.rooms=[],this.state="disconnected",this.options=this.defaults();for(var n in t)this.options[n]=t[n];e&&(this.externalClient=!0,this.client=e)};if("undefined"==typeof Primus){var n=require("util"),r=require("events").EventEmitter;n.inherits(e,r)}else e.prototype=new Primus.EventEmitter;e.prototype.defaults=function(){return{apiPath:"/api",url:null}},e.prototype.connect=function(t){var e=this;e.messageCount=0,e.client&&!0!==e.externalClient?(e.client.end(),e.client.removeAllListeners(),delete e.client,e.client=Primus.connect(e.options.url,e.options)):e.client&&!0===e.externalClient?(e.client.end(),e.client.open()):e.client=Primus.connect(e.options.url,e.options),e.client.on("open",function(){e.configure(function(n){"connected"===e.state||(e.state="connected","function"==typeof t&&t(null,n)),e.emit("connected")})}),e.client.on("error",function(t){e.emit("error",t)}),e.client.on("reconnect",function(){e.messageCount=0,e.emit("reconnect")}),e.client.on("reconnecting",function(){e.emit("reconnecting"),e.state="reconnecting",e.emit("disconnected")}),e.client.on("timeout",function(){e.state="timeout",e.emit("timeout")}),e.client.on("close",function(){e.messageCount=0,"disconnected"!==e.state&&(e.state="disconnected",e.emit("disconnected"))}),e.client.on("end",function(){e.messageCount=0,"disconnected"!==e.state&&(e.state="disconnected",e.emit("disconnected"))}),e.client.on("data",function(t){e.handleMessage(t)})},e.prototype.configure=function(t){var e=this;e.rooms.forEach(function(t){e.send({event:"roomAdd",room:t})}),e.detailsView(function(n){e.id=n.data.id,e.fingerprint=n.data.fingerprint,e.rooms=n.data.rooms,t(n)})},e.prototype.send=function(t,e){this.messageCount++,"function"==typeof e&&(this.callbacks[this.messageCount]=e),this.client.write(t)},e.prototype.handleMessage=function(t){this.emit("message",t),"response"===t.context?("function"==typeof this.callbacks[t.messageCount]&&this.callbacks[t.messageCount](t),delete this.callbacks[t.messageCount]):"user"===t.context?this.emit("say",t):"alert"===t.context?this.emit("alert",t):t.welcome&&"api"===t.context?(this.welcomeMessage=t.welcome,this.emit("welcome",t)):"api"===t.context&&this.emit("api",t)},e.prototype.action=function(t,e,n){n||"function"!=typeof e||(n=e,e=null),e||(e={}),e.action=t,"connected"!==this.state?this.actionWeb(e,n):this.actionWebSocket(e,n)},e.prototype.actionWeb=function(t,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){var t;if(4===n.readyState){if(200===n.status)t=JSON.parse(n.responseText);else try{t=JSON.parse(n.responseText)}catch(e){t={error:{statusText:n.statusText,responseText:n.responseText}}}e(t)}};var r=(t.httpMethod||"POST").toUpperCase(),i=this.options.url+this.options.apiPath+"?action="+t.action;if("GET"===r)for(var o in t)~["action","httpMethod"].indexOf(o)||(i+="&"+o+"="+t[o]);n.open(r,i,!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(t))},e.prototype.actionWebSocket=function(t,e){this.send({event:"action",params:t},e)},e.prototype.say=function(t,e,n){this.send({event:"say",room:t,message:e},n)},e.prototype.file=function(t,e){this.send({event:"file",file:t},e)},e.prototype.detailsView=function(t){this.send({event:"detailsView"},t)},e.prototype.roomView=function(t,e){this.send({event:"roomView",room:t},e)},e.prototype.roomAdd=function(t,e){var n=this;n.send({event:"roomAdd",room:t},function(t){n.configure(function(){"function"==typeof e&&e(t)})})},e.prototype.roomLeave=function(t,e){var n=this,r=n.rooms.indexOf(t);r>-1&&n.rooms.splice(r,1),this.send({event:"roomLeave",room:t},function(t){n.configure(function(){"function"==typeof e&&e(t)})})},e.prototype.documentation=function(t){this.send({event:"documentation"},t)},e.prototype.disconnect=function(){this.state="disconnected",this.client.end(),this.emit("disconnected")};e=e;t.ActionheroWebsocketClient=e,t.ActionheroWebsocketClient=e}("undefined"==typeof exports?window:exports);